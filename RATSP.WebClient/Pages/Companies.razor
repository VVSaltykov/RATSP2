@page "/Companies"
@using RATSP.Common.Interfaces
@using RATSP.Common.Models
@using RATSP.WebClient.Pages.Modals
@inject ICompaniesService ICompaniesService
@inject DialogService DialogService

<RadzenDataGrid Data="@companies" AllowFiltering=true ColumnWidth="300px" AllowColumnPicking=@WithColumnPicker>
    <HeaderTemplate>
        <RadzenButton Text="Создать компанию" Click="@OpenCreateDialog"  />
    </HeaderTemplate>
    <Columns>
        <RadzenDataGridColumn Visible="@EmployeeIDVisible" Property="@nameof(Company.Id)" Title="ID" Width="80px" TextAlign="TextAlign.Center" Frozen="true" />
        <RadzenDataGridColumn Property="@nameof(Company.Name)" Title="Название" />
        <RadzenDataGridColumn Property="@nameof(Company.Participation)" Title="Участие в РАТСП" Width="150px"/>
        <RadzenDataGridColumn Property="@nameof(Company.INN)" Title="ИНН" />
    </Columns>
</RadzenDataGrid>

@code {
    bool EmployeeIDVisible = false;
    IEnumerable<Company> companies;

    [Parameter]
    public bool WithColumnPicker { get; set; } = false;
    
    protected override async Task OnInitializedAsync()
    {
        companies = await ICompaniesService.Read();
    }   
    
    private async Task OpenCreateDialog()
    {
        try
        {
            var result = await DialogService.OpenAsync<CreateCompany>("Создание компании");
        
            if (result != null)
            {
                Company company = (Company)result;
                await ICompaniesService.Create(company);
                StateHasChanged();
            }
        }
        catch (Exception ex) {}
    }
}